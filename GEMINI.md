# Gemini プロジェクト設定

## 1. プロジェクトの基本

### 1.1. 概要

これは、AtCoderのような競技プログラミングのコンテスト問題をRust言語で解くためのリポジトリです。
コンテスト問題のコードに加えて、ライブラリも同梱されています。

### 1.2. プロジェクトの構造

本プロジェクトは Cargo ワークスペースで構成されており、以下の単位でパッケージ管理されています。

- **ワークスペースルート (`Cargo.toml`)**:
  - 全体の構成（members）と、共通の依存ライブラリのバージョンを一括管理。
- **年度別パッケージ (`src/contest/YYYY/Cargo.toml`)**:
  - 該当年度の各問題（`abcXXX/q/q.rs`）をバイナリターゲットとして定義・管理。
- **共通ライブラリパッケージ (`src/mylib/Cargo.toml`)**:
  - 再利用可能なモジュールやコードスニペットを `mylib` クレートとして管理。
- **サンプルパッケージ (`src/example/Cargo.toml`)**:
  - 特定のアルゴリズムやデータ構造の練習用コードを `example` クレートとして管理。
- **検証用パッケージ (`src/library_checker/Cargo.toml`)**:
  - Library Checker 用の検証コードを `library_checker` パッケージとして管理。
- **テンプレート用パッケージ (`src/contest/Cargo.toml`)**:
  - `template.rs` 等のテンプレートファイルを即座に実行・検証するためのパッケージ。

### 1.3. 支援ツール

開発を補助するためのスクリプト群です。これらは人間が使うことを想定していて、AIエージェントが使うことは想定していません。

- `contest.py`: 指定したコンテスト・問題用のディレクトリ作成とファイル配置を自動化し、`Cargo.toml` 用の定義を出力します。
- `script.sh`: `oj test` や提出、ビルド・実行などの頻用コマンドをエイリアス（`ojt`, `ojs`, `exe` 等）として提供します（`source script.sh` で使用）。

## 1.4. スキル活性化プロトコル（強制手順）

タスクの「Understand（理解）」フェーズにおいて、以下の条件に合致する場合は、具体的な計画（Plan）を立てる前に必ず `activate_skill` を実行してください。これは「意識」ではなく、プロジェクトの「標準作業手順（SOP）」として定義されます。

- **`src/mylib` 配下のファイル操作（読込・書込・テスト）**:
  - `lib-dev-standards` (設計指針)
  - `code-verifier` (自動検証プロトコル)
- **Python スクリプト実行・依存関係操作**:
  - `uv-manager` (環境管理)
- **対称性のあるファイル群（min/max等）の編集**:
  - `symmetry-syncer` (構造同期)
- **スキルの作成・更新・考察**:
  - `skill-creator` (スキル開発)
  - **スキル作成の運用**: 本プロジェクトでは、作成したスキルを `.skill` 形式（zip）にパッケージングする必要はありません。`.gemini/skills/<skill-name>/` ディレクトリに直接ファイルを配置してください。不要なバイナリファイルの生成を避けるため、`package_skill.cjs` は実行しないでください。

## 2. 開発の進め方

### 2.1. 基本ルール

- **実装指示の尊重**: 具体的な実装指示があるまで、ファイルへの書き込みは行わないでください。
    - 「レビューして」「確認して」という依頼に対しては、絶対にファイルへの書き込み（`replace`, `write_file`）を行わないでください。
    - ユーザーの意図を慎重に判断し、不明な場合は実装方針を提案して同意を得てください。
- **解法提示の制限**: ユーザーが解法を明示的に求めていない状況で、未実装の問題に対する解法やアルゴリズムの詳細を提示しないでください。これは、ユーザー自身の「振り返り」「考察」「試行錯誤」といった自律的な学習・成長プロセスを阻害する可能性があるためです。
- **Git利用**: `git commit` `git reset` `git checkout` などのリポジトリや編集中のファイルに副作用を及ぼすコマンドは使用しないでください。過去の状態を参照したい場合は安全に取り出す方法（git show や git diff）を用いてください。
- **ファイル管理**: 作業中に作成したスクリプトファイルや、実装途中のコードは、ユーザーの確認が済むまで削除しないでください。
- **計算量への配慮**: 競技プログラミングでは計算量が重要です。計算量が異なるアルゴリズムは、機能が同じでも別物として扱います。
- **指示してないことを無断で行わない**: 指示した内容以外でコードのリファクタリングをしたほうが良いと判断した内容はユーザに確認を取ってください。指示されたインターフェースやアルゴリズムと異なる方針を採るほうが良いと判断した場合も、実装前に必ず提案し、承諾を得てください。ユーザに確認を取るまでは指示した内容以外の変更を行わないでください。
- **提案先行プロトコル**: 技術的制約（Rustの型システムによる制限等）により、当初の指示通りの実装が困難であると判明した場合、独断で代替案（メソッド化等）を実装せず、まず状況を報告し、代替案を提案してユーザーの同意を得てください。

### 2.2. ライブラリ開発

ライブラリのコードを編集した際は、**必ず `code-verifier` スキルを活性化し、その指示（The Verification Flow）に厳格に従ってください**。

また、設計にあたっては `lib-dev-standards` スキルの指針を遵守してください。
これらのスキルは「1.4. スキル活性化プロトコル」に基づき、自動的に活性化されるべきものです。

### 2.3. コーディング規約

コーディング規約（`rand` クレートの利用、コメント、スタイル、インポートルール等）については、**`lib-dev-standards` スキルの「4. コーディング規約」に従ってください**。

また、ランダムテストの実装については同スキルの [random-testing.md](.gemini/skills/lib-dev-standards/references/random-testing.md) を参照してください。

### 2.4. コンテスト問題のコードについて

- テンプレートファイルは `src/contest/template.rs` および `src/contest/template2.rs` に配置されています。
- `src/contest/YYYY/abcXXX/q/q.rs` 等のコンテスト問題用ファイルに含まれる `tests` モジュール（ランダムテスト用テンプレート）や `print_util` モジュール（出力用ユーティリティ）は、**テンプレートのままであっても問題ありません**。
- これらは必要に応じて使用するものであり、使用しない場合に無理に削除したり、空の実装を埋めたりする必要はありません。
- **原則として、コードの直接編集は絶対に行わないでください。** 修正やリファクタリングが必要と判断した場合でも、必ず**修正提案に留めてください**。
- リファクタリングの際も、これらのテンプレートコードが未使用であることを理由に削除提案をする必要はありません。


## 3. 開発環境

### 3.1. サンドボックス環境

- Rust と Python (uv) が利用可能です。
- サンドボックス環境の詳細は `.gemini/Dockerfile` を参照してください。

## 4. 開発のテクニック

1. **修正箇所は1箇所とは限らない**: ある箇所を指摘されて修正した場合は、同様のパターンや構造を持つ他の箇所にも適用可能であるかを調査してください。
1. **周りのコードも見る**: 一部のコードを修正したらその周りのコードも見て、整合性が取れているか確認してください。一部を修正した結果、周りと整合性が取れていないことがよくあります。
1. **正確な文字数カウント**: 文字数をカウントする場合は、手作業を避け、必ず Python スクリプトを使用してください。実行時は `Total Length` だけでなく、カウント対象とした文字列そのものも出力に含めてください。
